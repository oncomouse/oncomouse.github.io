'use strict';document.addEventListener('DOMContentLoaded',()=>{alertify.logPosition('bottom right');const a=R.curry((a,b)=>{let c=Math.random()*(b-a)+a;return Math.floor(c)}),b='POEM',c='RESET',d='WORDS',e='ERROR',f={words:[],poem:'',lastMessage:Date.now(),messages:[]},g=()=>`${0.5<Math.random()?'\n':' '}${R.join('',R.times(()=>' ',a(0,7)))}`,h=R.sort(()=>Math.random()-0.5),i=R.compose(R.filter(R.compose(R.equals(0),R.length,R.match(/^[0-9]+$/))),R.match(/(\w+)/g),R.replace(/\'s/,'')),j=(b)=>R.nth(a(0,b.length))(b),k=R.curry((a,b)=>R.times(()=>j(b),a)),l=(a,b)=>R.compose(R.reduce((a,b)=>a+`${g()}${b}`,''),k(a))(b),n=Redux.createStore((a=f,g)=>{switch(g.type){case c:return Object.assign({},f);case d:return Object.assign({},a,{words:i(g.payload.words)});case b:return Object.assign({},a,{poem:l(g.payload.numberOfWords,a.words)});case'MESSAGE':return Object.assign({},a,{messages:a.messages.concat({message:g.payload.message,error:!1,timestamp:Date.now()})});case e:return Object.assign({},a,{messages:a.messages.concat({message:g.payload.message,error:!0,timestamp:Date.now()})});default:return a;}}),o={view:function({attrs:a}){return m('form',{id:'PoemForm',class:'cutestrap-form ta-center',onsubmit:a.handleSubmit},m('label',{class:'textfield'},m('input',{name:'numberOfWords',placeholder:'0',type:'number'}),m('span',{class:'textfield__label'},'How Many Words?')),m('button',{type:'submit'},'Create a Poem'))}},p={formatPoem:R.compose(R.join('<br/>'),R.map((a)=>a.replace(/\s+/g,(a)=>a.replace(/\s/g,'&nbsp;'))),R.split('\n')),view:function({attrs:a}){return m('section',{id:'Poem'},m('p',{},m.trust(this.formatPoem(a.poem))),m(o,a))}},q={view:function({attrs:a}){return m('form',{class:'cutestrap-form ta-center'},m('label',{class:'textfield'},m('textarea',{id:'WordInput',onchange:m.withAttr('value',a.handleChange)}),m('span',{class:'textfield__label'},'Words to Cut Up')),m('button',{onClick:a.handleReset,class:'btn--secondary',id:'ResetButton'},'Reset Word Bank'))}},r={oninit:function(){this.props={poem:'',lastMessage:Date.now(),words:[],handleSubmit:this.handleSubmit,handleReset:this.handleReset,handleChange:this.handleChange}},onupdate:function(){let a=n.getState();const b={};this.props.poem!=a.poem&&(b.poem=a.poem),0===a.words.length&&this.props.words.length!==a.words.length&&(document.querySelector('#WordInput').value='');let c=a.messages.filter((a)=>a.timestamp>this.props.lastMessage);0<c.length&&(R.map((a)=>(a.error?alertify.closeLogOnClick(!0).error(a.message):alertify.closeLogOnClick(!0).log(a.message),a))(c),b.lastMessage=Date.now()),this.props=Object.assign({},this.props,b)},handleChange:function(a){n.dispatch({type:d,payload:{words:a}})},handleReset:function(){n.dispatch({type:c})},handleSubmit:function(a){a.preventDefault(),a.stopPropagation();let c=n.getState(),d=parseInt(a.target.querySelector('input').value||0);isNaN(d)?n.dispatch({type:e,payload:{message:'You have to enter a number!'}}):0>=d?n.dispatch({type:e,payload:{message:'You have to request a number of words greater than 0!'}}):0===c.words.length?n.dispatch({type:e,payload:{message:'There are no words in the word bank! Load some first!'}}):n.dispatch({type:b,payload:{numberOfWords:d}})},view:function(){return m('main',{class:'wrapper-small'},m('h1',{class:'ta-center'},'Dada Poem Generator'),m(p,this.props),m(q,this.props))}},s=()=>{m.mount(document.body,r)};n.subscribe(s),s()});

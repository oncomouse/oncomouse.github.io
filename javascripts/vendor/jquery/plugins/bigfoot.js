!function(e){e.bigfoot=function(t){var n,o=e.extend({actionOriginalFN:"hide",activateCallback:function(){},activateOnHover:!1,allowMultipleFN:!1,appendPopoversTo:void 0,breakpoints:{},deleteOnUnhover:!1,hoverDelay:250,numberResetSelector:void 0,popoverDeleteDelay:300,popoverCreateDelay:100,positionNextToBlock:!0,positionContent:!0,preventPageScroll:!0,scope:!1,useFootnoteOnlyOnce:!0,contentMarkup:'<aside class="footnote-content bottom"data-footnote-number="{{FOOTNOTENUM}}" data-footnote-identifier="{{FOOTNOTEID}}" alt="Footnote {{FOOTNOTENUM}}"><div class="footnote-main-wrapper"><div class="footnote-content-wrapper">{{FOOTNOTECONTENT}}</div></div><div class="tooltip"></div></aside>',buttonMarkup:'<a href="#" class="footnote-button" id="{{SUP:data-footnote-backlink-ref}}" data-footnote-number="{{FOOTNOTENUM}}" data-footnote-identifier="{{FOOTNOTEID}}" alt="See Footnote {{FOOTNOTENUM}}" rel="footnote"data-footnote-content="{{FOOTNOTECONTENT}}"><span class="footnote-circle" data-footnote-number="{{FOOTNOTENUM}}"></span><span class="footnote-circle"></span><span class="footnote-circle"></span></a>'},t),r=function(){var t;t=o.scope?o.scope+' a[href*="#"]':'a[href*="#"]';var n,r,c=e(t).filter(function(){var t=e(this),n=t.attr("rel");return n&&"null"!=n||(n=""),(t.attr("href")+n).match(/(fn|footnote|note)[:\-_\d]/gi)&&t.closest("[class*=footnote]:not(a):not(sup)").length<1}),u=[],f=[],d=[];i(c,f),e(f).each(function(){n=e(this).attr("data-footnote-ref").replace(/[:.+~*\]\[]/g,"\\$&"),o.useFootnoteOnlyOnce&&(n+=":not(.footnote-processed)"),r=e(n).closest("li"),r.length>0&&(u.push(r.first().addClass("footnote-processed")),d.push(this))});for(var p,h,g,m,v,y,b,x,w=1,T=0;T<u.length;T++){g=s(e(u[T]).html().trim(),e(d[T]).data("footnote-backlink-ref")).replace(/"/g,"&quot;").replace(/&lt;/g,"&ltsym;").replace(/&gt;/g,"&gtsym;"),m=+(T+1),b="",v=e(d[T]),y=e(u[T]),o.numberResetSelector?(h=v.closest(o.numberResetSelector),h.is(p)?w+=1:w=1,p=h):w=m,0!==g.indexOf("<")&&(g="<p>"+g+"</p>"),b=o.buttonMarkup.replace(/\{\{FOOTNOTENUM\}\}/g,w).replace(/\{\{FOOTNOTEID\}\}/g,m).replace(/\{\{FOOTNOTECONTENT\}\}/g,g),b=l(b,"SUP",v),b=l(b,"FN",y),x=e(b).insertBefore(v);var C=y.parent();switch(o.actionOriginalFN.toLowerCase()){case"delete":v.remove(),y.remove(),a(C);break;case"hide":v.addClass("footnote-print-only"),y.addClass("footnote-print-only"),a(C);break;case"ignore":v.addClass("footnote-print-only")}}},i=function(t,n){var o,r,i,a;t.each(function(){var t=e(this);i="#"+t.attr("href").split("#")[1],o=t.closest("sup"),r=t.find("sup"),o.length>0?(a=(o.attr("id")||"")+(t.attr("id")||""),n.push(o.attr({"data-footnote-backlink-ref":a,"data-footnote-ref":i}))):r.length>0?(a=(r.attr("id")||"")+(t.attr("id")||""),n.push(t.attr({"data-footnote-backlink-ref":a,"data-footnote-ref":i}))):(a=t.attr("id")||"",n.push(t.attr({"data-footnote-backlink-ref":a,"data-footnote-ref":i})))})},a=function(e){var t;e.is(":empty")||0===e.children(":not(.footnote-print-only)").length?(t=e.parent(),"delete"===o.actionOriginalFN.toLowerCase()?e.remove():e.addClass("footnote-print-only"),a(t)):e.children(":not(.footnote-print-only)").length==e.children("hr:not(.footnote-print-only)").length&&(t=e.parent(),"delete"===o.actionOriginalFN.toLowerCase()?e.remove():(e.children("hr").addClass("footnote-print-only"),e.addClass("footnote-print-only")),a(t))},s=function(e,t){t.indexOf(" ")>=0&&(t=t.trim().replace(/ +/g,"|").replace(/(.*)/g,"($1)"));var n=new RegExp("(\\s|&nbsp;)*<\\s*a[^#<]*#"+t+"[^>]*>(.*?)<\\s*/\\s*a>","g");return e.replace(n,"").replace("[]","")},l=function(e,t,n){var o,r,i=new RegExp("\\{\\{"+t+":([^\\}]*)\\}\\}","g");for(o=i.exec(e);o;)o[1]&&(r=n.attr(o[1])||"",e=e.replace("{{"+t+":"+o[1]+"}}",r)),o=i.exec(e);return e},c=function(t){if(o.activateOnHover){var n=e(t.target).closest(".footnote-button"),r='[data-footnote-identifier="'+n.attr("data-footnote-identifier")+'"]';if(n.hasClass("active"))return;if(n.addClass("hover-instantiated"),!o.allowMultipleFN){var i=".footnote-content:not("+r+")";g(i)}d(".footnote-button"+r).addClass("hover-instantiated")}},u=function(t){var n=e(t.target),o=n.closest(".footnote-button");$nearFootnote=n.closest(".footnote-content"),o.length>0?(t.preventDefault(),f(o)):$nearFootnote.length<1&&e(".footnote-content").length>0&&g()},f=function(e){e.blur();var t='data-footnote-identifier="'+e.attr("data-footnote-identifier")+'"';e.hasClass("changing")||(e.hasClass("active")?o.allowMultipleFN?g(".footnote-content["+t+"]"):g():(e.addClass("changing"),setTimeout(function(){e.removeClass("changing")},o.popoverCreateDelay),d(".footnote-button["+t+"]"),e.addClass("click-instantiated"),o.allowMultipleFN||g(".footnote-content:not(["+t+"])")))},d=function(t){t=t||".footnote-button";var n;n="string"!=typeof t&&o.allowMultipleFN?t:"string"!=typeof t?t.first():o.allowMultipleFN?e(t).closest(".footnote-button"):e(t+":first").closest(".footnote-button");var r=e();return n.each(function(){var t,n=e(this);try{t=o.contentMarkup.replace(/\{\{FOOTNOTENUM\}\}/g,n.attr("data-footnote-number")).replace(/\{\{FOOTNOTEID\}\}/g,n.attr("data-footnote-identifier")).replace(/\{\{FOOTNOTECONTENT\}\}/g,n.attr("data-footnote-content").replace(/&gtsym;/,"&gt;").replace(/&ltsym;/,"&lt;")),t=l(t,"BUTTON",n)}finally{$content=e(t);try{o.activateCallback($content)}catch(i){}o.appendPopoversTo?$content.appendTo(o.appendPopoversTo+":first"):($nearestBlock=n.closest("p, div, pre, li, ul, section, article, main, aside"),$siblingFootnote=$nearestBlock.siblings(".footnote-content:last"),$content.insertAfter($siblingFootnote.length>0?$siblingFootnote:$nearestBlock)),$content.attr("data-bigfoot-max-height",$content.height()),m(),n.addClass("active"),$content.find(".footnote-content-wrapper").bindScrollHandler(),r=r.add($content)}}),setTimeout(function(){r.addClass("active")},o.popoverCreateDelay),r};e.fn.bindScrollHandler=function(){o.preventPageScroll&&e(this).on("DOMMouseScroll mousewheel",function(t){var n=e(this),o=n.scrollTop(),r=n[0].scrollHeight,i=parseInt(n.css("height")),a=n.closest(".footnote-content");if(n.scrollTop()>0&&n.scrollTop()<10&&a.addClass("scrollable"),a.hasClass("scrollable")){var s="DOMMouseScroll"==t.type?-40*t.originalEvent.detail:t.originalEvent.wheelDelta,l=s>0,c=function(){return t.stopPropagation(),t.preventDefault(),t.returnValue=!1,!1};return!l&&-s>r-i-o?(n.scrollTop(r),a.addClass("fully-scrolled"),c()):l&&s>o?(n.scrollTop(0),a.removeClass("fully-scrolled"),c()):void a.removeClass("fully-scrolled")}})};var p=function(t){o.deleteOnUnhover&&o.activateOnHover&&setTimeout(function(){e(t.target).closest(".footnote-content, .footnote-button");e(".footnote-button:hover, .footnote-content:hover").length<1&&g()},o.hoverDelay)},h=function(e){27==e.keyCode&&g()},g=function(t,n){t=t||".footnote-content",n=n||o.popoverDeleteDelay;var r,i,a,s=e();return e(t).each(function(){a=e(this),r=a.attr("data-footnote-identifier"),i=e('.footnote-button[data-footnote-identifier="'+r+'"]'),i.hasClass("changing")||(s=s.add(i),i.removeClass("active hover-instantiated click-instantiated").addClass("changing"),a.removeClass("active").addClass("disapearing"),setTimeout(function(){a.remove(),i.removeClass("changing")},n))}),s},m=function(){o.positionContent&&e(".footnote-content").each(function(){var t=e(this),n='data-footnote-identifier="'+t.attr("data-footnote-identifier")+'"',o=(t.find(".footnote-content-wrapper"),e(".footnote-button["+n+"]")),r=y(o),i=parseFloat(t.css("width")),a=parseFloat(t.css("margin-top")),s=+t.attr("data-bigfoot-max-height"),l=2*a+s,c=1e4;r.bottomRoom<l&&r.topRoom>r.bottomRoom?(t.css({top:"auto",bottom:r.bottomRoom+"px"}).addClass("top").removeClass("bottom"),c=r.topRoom-a-15,t.css({"transform-origin":100*r.leftRelative+"% 100%"})):(t.css({bottom:"auto",top:r.topRoom+"px"}).addClass("bottom").removeClass("top"),c=r.bottomRoom-a-15,t.css({"transform-origin":100*r.leftRelative+"% 0%"})),t.find(".footnote-content-wrapper").css({"max-height":Math.min(c,s)+"px"}),t.css({left:r.leftRoom-r.leftRelative*i+"px"}),v(t,r.leftRelative),parseInt(t.css("height"))<t.find(".footnote-content-wrapper")[0].scrollHeight&&t.addClass("scrollable")})},v=function(e,t){t=t||.5;var n=e.find(".tooltip");n.length>0&&n.css({left:100*t+"%"})},y=function(t){var n=parseFloat(t.outerWidth()),o=parseFloat(t.outerHeight()),r=b(),i=t.offset().top-e(window).scrollTop()+o/2,a=t.offset().left+n/2;return{topRoom:i,bottomRoom:r.height-i,leftRoom:a,rightRoom:r.width-a,leftRelative:a/r.width,topRelative:i/r.height}},b=function(){var e=document.createElement("div");e.style.cssText="position: fixed;top: 0;left: 0;bottom: 0;right: 0;",document.documentElement.insertBefore(e,document.documentElement.firstChild);var t={width:e.offsetWidth,height:e.offsetHeight};return document.documentElement.removeChild(e),t},x=function(e,t,r,i,a){t=t||o.popoverDeleteDelay,(null===r||r!==!1)&&(r=!0);var s,l,c;if("string"==typeof e){c="iphone"===e.toLowerCase()?"<320px":"ipad"===e.toLowerCase()?"<768px":e,l=">"===c.charAt(0)?"min":"<"===c.charAt(0)?"max":null;var u=l?"("+l+"-width: "+c.substring(1)+")":c;s=window.matchMedia(u)}else s=e;if(s.media&&"invalid"===s.media)return{added:!1,mq:s,listener:null};var f="min"===l,d="max"===l;i=i||w(r,t,f,function(e){e.addClass("fixed-bottom")}),a=a||w(r,t,d,function(){});var p=function(e){e.matches?i(r,n):a(r,n)};return s.addListener(p),p(s),o.breakpoints[e]={added:!0,mq:s,listener:p},o.breakpoints[e]},w=function(e,t,n,o){return function(e,r){var i;e&&(i=r.close(),r.updateSetting("activateCallback",o)),setTimeout(function(){r.updateSetting("positionContent",n),e&&r.activate(i)},t)}},T=function(e,t){var n;if("string"==typeof e)mqFound=void 0!==o.breakpoints[e];else for(n in o.breakpoints)if(o.breakpoints.hasOwnProperty(n)&&o.breakpoints[n].mq===e){mqFound=!0;break}if(mqFound){var r=o.breakpoints[n||e];t?t({matches:!1}):r.listener({matches:!1}),r.mq.removeListener(r.listener),delete o.breakpoints[n||e]}return mqFound},C=function(e,t){var n;if("string"==typeof e)n=o[e],o[e]=t;else{n={};for(var r in e)e.hasOwnProperty(r)&&(n[r]=o[r],o[r]=e[r])}return n},k=function(e){return o[e]};return e(document).ready(function(){r(),e(document).on("mouseenter",".footnote-button",c),e(document).on("touchend click",u),e(document).on("mouseout",".hover-instantiated",p),e(document).on("keyup",h),e(window).on("scroll resize",m)}),n={close:function(e,t){return g(e,t)},activate:function(e){return d(e)},reposition:function(){return m()},addBreakpoint:function(e,t,n,o,r){return x(e,t,n,o,r)},removeBreakpoint:function(e,t){return T(e,t)},getSetting:function(e){return k(e)},updateSetting:function(e,t){return C(e,t)}}}}(jQuery);